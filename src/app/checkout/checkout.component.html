<div class="container py-4">
  <div class="row justify-content-center">
    <div class="col-lg-8">

      <h1 class="text-center mb-4">Checkout</h1>

      <form [formGroup]="checkoutForm" (ngSubmit)="onSubmit()" novalidate>

        <!-- Dati di Spedizione -->
        <div class="card shadow-sm mb-4">
          <div class="card-header bg-dark text-white">
            <h2 class="h5 mb-0">Dati di Spedizione</h2>
          </div>
          <div class="card-body">

            <!-- Nome e Cognome -->
            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">Nome*</label>
                <input type="text" formControlName="nome" class="form-control" [class.is-invalid]="f['nome'].touched && f['nome'].invalid" />
                <div *ngIf="f['nome'].touched && f['nome'].invalid" class="invalid-feedback">
                  Inserisci un nome valido (min 2 caratteri).
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Cognome*</label>
                <input type="text" formControlName="cognome" class="form-control" [class.is-invalid]="f['cognome'].touched && f['cognome'].invalid" />
                <div *ngIf="f['cognome'].touched && f['cognome'].invalid" class="invalid-feedback">
                  Inserisci un cognome valido (min 2 caratteri).
                </div>
              </div>
            </div>

            <!-- Indirizzo -->
            <div class="mb-3">
              <label class="form-label">Indirizzo (Via e Civico)*</label>
              <input type="text" formControlName="indirizzo" class="form-control" [class.is-invalid]="f['indirizzo'].touched && f['indirizzo'].invalid" />
              <div *ngIf="f['indirizzo'].touched && f['indirizzo'].invalid" class="invalid-feedback">
                Inserisci un indirizzo valido.
              </div>
            </div>

            <!-- Città e CAP -->
            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">Città*</label>
                <input type="text" formControlName="citta" class="form-control" [class.is-invalid]="f['citta'].touched && f['citta'].invalid" />
                <div *ngIf="f['citta'].touched && f['citta'].invalid" class="invalid-feedback">
                  Inserisci una città valida.
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label">CAP*</label>
                <input type="text" formControlName="cap" maxlength="5" class="form-control" [class.is-invalid]="f['cap'].touched && f['cap'].invalid" />
                <div *ngIf="f['cap'].touched && f['cap'].invalid" class="invalid-feedback">
                  Il CAP deve contenere 5 cifre.
                </div>
              </div>
            </div>

            <!-- Email e Telefono -->
            <div class="row mb-4">
              <div class="col-md-6">
                <label class="form-label">Email*</label>
                <input type="email" formControlName="email" class="form-control" [class.is-invalid]="f['email'].touched && f['email'].invalid" />
                <div *ngIf="f['email'].touched && f['email'].invalid" class="invalid-feedback">
                  Inserisci un'email valida.
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Telefono*</label>
                <input type="tel" formControlName="telefono" class="form-control" [class.is-invalid]="f['telefono'].touched && f['telefono'].invalid" />
                <div *ngIf="f['telefono'].touched && f['telefono'].invalid" class="invalid-feedback">
                  Inserisci un numero di telefono valido (solo cifre, 6-15 caratteri).
                </div>
              </div>
            </div>

          </div>
        </div>

        <!-- Dati di Pagamento -->
        <div class="card shadow-sm mb-4">
          <div class="card-header bg-dark text-white">
            <h2 class="h5 mb-0">Dati di Pagamento</h2>
          </div>
          <div class="card-body">

            <div class="mb-3">
              <label class="form-label">Numero Carta di Credito*</label>
              <input type="text" formControlName="numeroCarta" maxlength="19" placeholder="1234 5678 9012 3456"
                class="form-control" [class.is-invalid]="f['numeroCarta'].touched && f['numeroCarta'].invalid" />
              <div *ngIf="f['numeroCarta'].touched && f['numeroCarta'].invalid" class="invalid-feedback">
                Inserisci un numero carta valido (16 cifre).
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">Nome sulla Carta*</label>
                <input type="text" formControlName="nomeCarta" class="form-control" [class.is-invalid]="f['nomeCarta'].touched && f['nomeCarta'].invalid" />
                <div *ngIf="f['nomeCarta'].touched && f['nomeCarta'].invalid" class="invalid-feedback">
                  Inserisci il nome presente sulla carta.
                </div>
              </div>
              <div class="col-md-3">
                <label class="form-label">Scadenza (MM/AA)*</label>
                <input type="text" formControlName="scadenza" maxlength="5" placeholder="MM/AA"
                  class="form-control" [class.is-invalid]="f['scadenza'].touched && f['scadenza'].invalid" />
                <div *ngIf="f['scadenza'].touched && f['scadenza'].invalid" class="invalid-feedback">
                  Inserisci una data di scadenza valida (MM/AA).
                </div>
              </div>
              <div class="col-md-3">
                <label class="form-label">CVV*</label>
                <input type="text" formControlName="cvv" maxlength="4" placeholder="123"
                  class="form-control" [class.is-invalid]="f['cvv'].touched && f['cvv'].invalid" />
                <div *ngIf="f['cvv'].touched && f['cvv'].invalid" class="invalid-feedback">
                  Inserisci un CVV valido (3 o 4 cifre).
                </div>
              </div>
            </div>

          </div>
        </div>

        <!-- TOTALE e PULSANTE -->
        <div *ngIf="totalPrice > 0">
          <div class="d-flex justify-content-end mb-4">
            <div class="bg-light p-3 rounded">
              <span class="fw-bold fs-5">TOTALE (iva inclusa) € </span>
              <span class="fw-bold fs-5">{{ totalPrice | number:'1.2-2' }}</span>
            </div>
          </div>

          <div class="d-flex justify-content-between align-items-center">
            <a routerLink="/cart" class="btn btn-outline-secondary btn-lg">
              <i class="bi bi-arrow-left me-2"></i> Torna al Carrello
            </a>

            <button type="submit" class="btn btn-success btn-lg px-4">
              <i class="bi bi-check-circle me-2"></i> Conferma Ordine
            </button>
          </div>
        </div>

        <!-- Carrello Vuoto -->
        <div *ngIf="totalPrice === 0" class="alert alert-info text-center mt-4">
          Il tuo carrello è vuoto. <a routerLink="/cart">Vai al carrello</a>
        </div>

      </form>
    </div>
  </div>
</div>
